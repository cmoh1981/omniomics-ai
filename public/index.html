<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OmniOmics AI - LLM-Powered Multi-Omics Analysis</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%); min-height: 100vh; color: #fff; }
        .container { max-width: 1200px; margin: 0 auto; padding: 40px 20px; }
        header { text-align: center; margin-bottom: 40px; }
        h1 { font-size: 2.5rem; margin-bottom: 10px; background: linear-gradient(90deg, #00d4ff, #7c3aed); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; }
        .subtitle { font-size: 1.1rem; color: #8892b0; }
        .tabs { display: flex; gap: 8px; margin-bottom: 30px; flex-wrap: wrap; }
        .tab { padding: 12px 24px; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 8px; cursor: pointer; transition: all 0.3s; color: #8892b0; }
        .tab.active { background: linear-gradient(90deg, #00d4ff, #7c3aed); color: #fff; border: none; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .section { background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 16px; padding: 28px; margin-bottom: 24px; }
        .section h2 { margin-bottom: 20px; color: #00d4ff; font-size: 1.4rem; }
        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; margin-bottom: 8px; color: #a8b2d1; font-weight: 500; }
        input[type="file"] { width: 100%; padding: 16px; background: rgba(0,0,0,0.3); border: 2px dashed rgba(255,255,255,0.2); border-radius: 8px; color: #a8b2d1; cursor: pointer; }
        input[type="file"]:hover { border-color: #00d4ff; }
        textarea { width: 100%; min-height: 120px; background: rgba(0,0,0,0.3); border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; padding: 16px; color: #fff; font-size: 1rem; margin-bottom: 16px; resize: vertical; }
        textarea:focus { outline: none; border-color: #00d4ff; }
        select, button { padding: 12px 24px; border-radius: 8px; font-size: 1rem; cursor: pointer; }
        select { background: rgba(0,0,0,0.3); border: 1px solid rgba(255,255,255,0.2); color: #fff; }
        button { background: linear-gradient(90deg, #00d4ff, #7c3aed); border: none; color: #fff; font-weight: 600; transition: transform 0.2s; }
        button:hover { transform: scale(1.05); }
        button:disabled { opacity: 0.6; cursor: not-allowed; }
        .response { background: rgba(0,0,0,0.3); border-radius: 8px; padding: 20px; min-height: 100px; white-space: pre-wrap; font-family: monospace; color: #a8b2d1; max-height: 400px; overflow-y: auto; }
        .status { display: inline-block; padding: 4px 12px; border-radius: 20px; font-size: 0.85rem; margin-left: 12px; }
        .status.online { background: rgba(0,255,136,0.2); color: #00ff88; }
        .status.error { background: rgba(255,68,68,0.2); color: #ff4444; }
        .file-info { margin-top: 8px; padding: 8px 12px; background: rgba(0,255,136,0.1); border-radius: 4px; color: #00ff88; font-size: 0.9rem; }
        .progress { display: none; margin: 16px 0; }
        .progress-bar { height: 8px; background: rgba(255,255,255,0.1); border-radius: 4px; overflow: hidden; }
        .progress-fill { height: 100%; background: linear-gradient(90deg, #00d4ff, #7c3aed); width: 0%; transition: width 0.3s; }
        .progress-text { margin-top: 8px; color: #8892b0; font-size: 0.9rem; }
        footer { text-align: center; color: #8892b0; padding: 20px; }
        footer a { color: #00d4ff; text-decoration: none; }
        .example-btn { background: rgba(255,255,255,0.1); border: none; color: #a8b2d1; padding: 12px 16px; text-align: left; border-radius: 8px; cursor: pointer; transition: all 0.2s; width: 100%; margin-bottom: 8px; }
        .example-btn:hover { background: rgba(255,255,255,0.15); color: #fff; }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>OmniOmics AI</h1>
            <p class="subtitle">LLM-Powered Multi-Omics Analysis</p>
            <span class="status online" id="status">Checking...</span>
        </header>

        <div class="tabs">
            <div class="tab active" onclick="switchTab('upload')">üì§ Upload & Analyze</div>
            <div class="tab" onclick="switchTab('chat')">üí¨ AI Chat</div>
            <div class="tab" onclick="switchTab('info')">‚ÑπÔ∏è Info</div>
        </div>

        <div id="upload" class="tab-content active">
            <div class="section">
                <h2>üß¨ Proteomics Analysis</h2>
                <div class="form-group">
                    <label>Upload Protein Groups File (MaxQuant)</label>
                    <input type="file" id="proteomicsFile" accept=".txt,.csv" onchange="handleFileSelect('proteomics')">
                    <div class="file-info" id="proteomicsFileInfo" style="display:none;"></div>
                </div>
                <div class="form-group">
                    <label>Experimental Design (Optional CSV)</label>
                    <input type="file" id="designFile" accept=".csv" onchange="handleFileSelect('design')">
                    <div class="file-info" id="designFileInfo" style="display:none;"></div>
                </div>
                <div class="form-group">
                    <label>LLM Provider</label>
                    <select id="analysisProvider">
                        <option value="gemini">Gemini (Google)</option>
                        <option value="kilo">Claude (via Kilo)</option>
                    </select>
                </div>
                <button onclick="runAnalysis()" id="analyzeBtn">üöÄ Run Analysis</button>
                <div class="progress" id="progress">
                    <div class="progress-bar"><div class="progress-fill" id="progressFill"></div></div>
                    <div class="progress-text" id="progressText">Processing...</div>
                </div>
            </div>
            <div class="section" id="resultsSection" style="display:none;">
                <h2>üìä Analysis Results</h2>
                <div class="response" id="analysisResults">Results will appear here...</div>
            </div>
        </div>

        <div id="chat" class="tab-content">
            <div class="section">
                <h2>ü§ñ Ask About Omics Data</h2>
                <div class="form-group">
                    <select id="chatProvider">
                        <option value="gemini">Gemini (Google)</option>
                        <option value="kilo">Claude (via Kilo)</option>
                    </select>
                </div>
                <textarea id="chatPrompt" placeholder="Ask about proteomics, transcriptomics, multi-omics integration..."></textarea>
                <button onclick="sendChat()" id="chatBtn">Send</button>
                <div class="response" id="chatResponse" style="margin-top: 20px;">Response will appear here...</div>
            </div>
            <div class="section">
                <h2>üí° Example Questions</h2>
                <button class="example-btn" onclick="setChatPrompt('What biological pathways are affected when 50 proteins are upregulated in a treatment group?')">What pathways are affected?</button>
                <button class="example-btn" onclick="setChatPrompt('Explain LFQ vs spectral counting in proteomics')">Explain LFQ vs spectral counting</button>
                <button class="example-btn" onclick="setChatPrompt('How do you perform multi-omics integration?')">How to do multi-omics integration?</button>
                <button class="example-btn" onclick="setChatPrompt('QC metrics for MaxQuant proteomics data')">QC metrics for MaxQuant</button>
            </div>
        </div>

        <div id="info" class="tab-content">
            <div class="section">
                <h2>üß¨ Supported Analysis</h2>
                <button class="example-btn" style="cursor:default;"><strong>Proteomics:</strong> Differential expression, pathway analysis</button>
                <button class="example-btn" style="cursor:default;"><strong>Transcriptomics:</strong> RNA-seq, gene expression</button>
                <button class="example-btn" style="cursor:default;"><strong>Multi-omics:</strong> PCA, MOFA integration</button>
            </div>
            <div class="section">
                <h2>üìÅ File Formats</h2>
                <button class="example-btn" style="cursor:default;">proteinGroups.txt (MaxQuant)</button>
                <button class="example-btn" style="cursor:default;">report.tsv (DIA-NN)</button>
                <button class="example-btn" style="cursor:default;">Count matrices (CSV)</button>
            </div>
        </div>

        <footer>
            <p>OmniOmics AI - <a href="https://github.com/cmoh1981/omniomics-ai">GitHub</a></p>
        </footer>
    </div>

    <script>
        const API_BASE = '';
        let proteomicsFile = null;
        let designFile = null;

        function switchTab(tabId) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            event.target.classList.add('active');
            document.getElementById(tabId).classList.add('active');
        }

        function handleFileSelect(type) {
            const input = type === 'proteomics' ? document.getElementById('proteomicsFile') : document.getElementById('designFile');
            const file = input.files[0];
            if (file) {
                if (type === 'proteomics') {
                    proteomicsFile = file;
                    const info = document.getElementById('proteomicsFileInfo');
                    info.textContent = '‚úì ' + file.name + ' (' + (file.size/1024).toFixed(1) + ' KB)';
                    info.style.display = 'block';
                } else {
                    designFile = file;
                    const info = document.getElementById('designFileInfo');
                    info.textContent = '‚úì ' + file.name + ' (' + (file.size/1024).toFixed(1) + ' KB)';
                    info.style.display = 'block';
                }
            }
        }

        async function runAnalysis() {
            const provider = document.getElementById('analysisProvider').value;
            const resultsDiv = document.getElementById('analysisResults');
            const progress = document.getElementById('progress');
            const progressFill = document.getElementById('progressFill');
            const progressText = document.getElementById('progressText');
            const btn = document.getElementById('analyzeBtn');

            if (!proteomicsFile) {
                resultsDiv.textContent = 'Please upload a proteomics file first';
                document.getElementById('resultsSection').style.display = 'block';
                return;
            }

            btn.disabled = true;
            progress.style.display = 'block';
            resultsDiv.textContent = 'Reading file...';
            document.getElementById('resultsSection').style.display = 'block';

            const reader = new FileReader();
            reader.onload = async function(e) {
                const content = e.target.result;
                progressFill.style.width = '30%';
                progressText.textContent = 'Analyzing with LLM...';

                try {
                    const res = await fetch(API_BASE + '/api/analyze', {
                        method: 'POST',
                        headers: {'Content-Type': 'application/json'},
                        body: JSON.stringify({
                            prompt: 'Analyze this proteomics data and provide biological insights:\n\n' + content.substring(0, 8000),
                            provider: provider,
                            fileName: proteomicsFile.name
                        })
                    });
                    const data = await res.json();
                    progressFill.style.width = '100%';
                    progressText.textContent = 'Complete!';
                    resultsDiv.textContent = data.analysis || JSON.stringify(data, null, 2);
                } catch (err) {
                    resultsDiv.textContent = 'Error: ' + err.message;
                }
                btn.disabled = false;
                setTimeout(() => { progress.style.display = 'none'; progressFill.style.width = '0%'; }, 2000);
            };
            reader.readAsText(proteomicsFile);
        }

        async function sendChat() {
            const prompt = document.getElementById('chatPrompt').value;
            const provider = document.getElementById('chatProvider').value;
            const responseDiv = document.getElementById('chatResponse');
            const btn = document.getElementById('chatBtn');

            if (!prompt.trim()) { responseDiv.textContent = 'Please enter a question'; return; }

            btn.disabled = true;
            btn.textContent = 'Thinking...';
            responseDiv.textContent = 'Processing...';

            try {
                const res = await fetch(API_BASE + '/api/analyze', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({prompt, provider})
                });
                const data = await res.json();
                responseDiv.textContent = data.analysis || JSON.stringify(data, null, 2);
            } catch (e) { responseDiv.textContent = 'Error: ' + e.message; }

            btn.disabled = false;
            btn.textContent = 'Send';
        }

        function setChatPrompt(text) {
            document.getElementById('chatPrompt').value = text;
            switchTab('chat');
        }

        async function checkStatus() {
            try {
                const res = await fetch(API_BASE + '/api/health');
                const data = await res.json();
                document.getElementById('status').textContent = 'API Online';
                document.getElementById('status').className = 'status online';
            } catch (e) {
                document.getElementById('status').textContent = 'API Offline';
                document.getElementById('status').className = 'status error';
            }
        }
        checkStatus();
    </script>
</body>
</html>
